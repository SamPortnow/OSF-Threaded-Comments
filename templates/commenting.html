<!DOCTYPE html>
<html>
<head>
    <title>Bootstrap 101 Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="../static/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <style>
        body {
            padding:10px;
        }
        div.comment-section {
            margin-left: -50px;
        }
        div.comment-group {
            margin-left: 50px;
            padding-left: 10px;
            border-left-style: dashed;
            border-left-color: pink;
        }
        div.comment-submit {
            display: none;
        }
    </style>
</head>
<body>
    
    <!-- Clear comments; remove in production -->
    <p>
        <button class="btn-primary" onclick="location.href = '/clear/';">
            Clear
        </button>
    </p>

    <p>
    <form action="/" method="post" class="add-entry">
        <textarea rows="3" name=comment></textarea>
    </p>
    <p><button class="btn-primary" type="submit">Comment</button>
    </p>
    </form>
    
    {% macro render_comment(comment) -%}
        
        <div class="comment-group">

            <div class="comment-container" id="{{comment._id}}">
                
                <!-- Comment date -->
                <div class="comment-date">
                    {{ comment.posted.strftime('%A, %d. %B %Y %I:%M %p') }}
                </div>
                pass

                <!-- Comment text -->
                <div class="table-bordered comment-text">
                    {{ comment.text|markdownify|safe }}
                </div>

                <!-- Comment reply -->
                <div class="comment-reply">
                    <button class="btn-primary comment-reply">Reply</button>
                </div>

                <!--  -->
                <div class="comment-submit">
                    <form action='/' method='post' class='comment-form'>
                        <textarea rows='3' name=comment></textarea>
                        <input type='hidden' name='parent' value="{{ comment._id }}" />
                        <div>
                            <button class="btn-primary">Submit</button>
                            <button class="btn-primary">Cancel</button>
                        </div>
                    </form>
                </div>

            </div>
            
            <!-- Render children -->
            {% for child in comment.children %}
                {{ render_comment(child) }}
            {% endfor %}

        </div>

    {%- endmacro %}
    
    <div class="comment-section">
        {% for comment in comments %}
            
            {{ render_comment(comment) }}

        {% endfor %}
    </div>

<script src="../static/bootstrap/js/bootstrap.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script>

    $(document).ready(function() {
        $('div.comment-reply button').click(function() {
            add_submit_btn(this);
        });
    });

    function add_submit_btn(elm) {
        
        $(elm)
            .closest('.comment-container')
            .find('.comment-reply, .comment-submit')
            .toggle();

    }
</script>
</body>
</html>
